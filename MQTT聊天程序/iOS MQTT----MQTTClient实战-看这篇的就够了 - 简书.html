<!DOCTYPE html>
<!--[if IE 6]><html class="ie lt-ie8"><![endif]-->
<!--[if IE 7]><html class="ie lt-ie8"><![endif]-->
<!--[if IE 8]><html class="ie ie8"><![endif]-->
<!--[if IE 9]><html class="ie ie9"><![endif]-->
<!--[if !IE]><!-->
<html><!--<![endif]--><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
<script type="text/javascript" src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/1255494d3a.js"></script><script src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/nr-1026.js"></script><script src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/push.js"></script><script async="" src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/analytics.js"></script><script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","licenseKey":"1255494d3a","applicationID":"15702971","transactionName":"e1daR0JWVV9RER9ZWkxdRxxDUVZE","queueTime":0,"applicationTime":110,"agent":""}</script>
<script type="text/javascript">window.NREUM||(NREUM={}),__nr_require=function(e,n,t){function r(t){if(!n[t]){var o=n[t]={exports:{}};e[t][0].call(o.exports,function(n){var o=e[t][1][n];return r(o||n)},o,o.exports)}return n[t].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<t.length;o++)r(t[o]);return r}({1:[function(e,n,t){function r(){}function o(e,n,t){return function(){return i(e,[c.now()].concat(u(arguments)),n?null:this,t),n?void 0:this}}var i=e("handle"),a=e(2),u=e(3),f=e("ee").get("tracer"),c=e("loader"),s=NREUM;"undefined"==typeof window.newrelic&&(newrelic=s);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],d="api-",l=d+"ixn-";a(p,function(e,n){s[n]=o(d+n,!0,"api")}),s.addPageAction=o(d+"addPageAction",!0),s.setCurrentRouteName=o(d+"routeName",!0),n.exports=newrelic,s.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(e,n){var t={},r=this,o="function"==typeof n;return i(l+"tracer",[c.now(),e,t],r),function(){if(f.emit((o?"":"no-")+"fn-start",[c.now(),r,o],t),o)try{return n.apply(this,arguments)}finally{f.emit("fn-end",[c.now()],t)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(e,n){m[n]=o(l+n)}),newrelic.noticeError=function(e){"string"==typeof e&&(e=new Error(e)),i("err",[e,c.now()])}},{}],2:[function(e,n,t){function r(e,n){var t=[],r="",i=0;for(r in e)o.call(e,r)&&(t[i]=n(r,e[r]),i+=1);return t}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],3:[function(e,n,t){function r(e,n,t){n||(n=0),"undefined"==typeof t&&(t=e?e.length:0);for(var r=-1,o=t-n||0,i=Array(o<0?0:o);++r<o;)i[r]=e[n+r];return i}n.exports=r},{}],4:[function(e,n,t){n.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(e,n,t){function r(){}function o(e){function n(e){return e&&e instanceof r?e:e?f(e,u,i):i()}function t(t,r,o,i){if(!d.aborted||i){e&&e(t,r,o);for(var a=n(o),u=m(t),f=u.length,c=0;c<f;c++)u[c].apply(a,r);var p=s[y[t]];return p&&p.push([b,t,r,a]),a}}function l(e,n){v[e]=m(e).concat(n)}function m(e){return v[e]||[]}function w(e){return p[e]=p[e]||o(t)}function g(e,n){c(e,function(e,t){n=n||"feature",y[t]=n,n in s||(s[n]=[])})}var v={},y={},b={on:l,emit:t,get:w,listeners:m,context:n,buffer:g,abort:a,aborted:!1};return b}function i(){return new r}function a(){(s.api||s.feature)&&(d.aborted=!0,s=d.backlog={})}var u="nr@context",f=e("gos"),c=e(2),s={},p={},d=n.exports=o();d.backlog=s},{}],gos:[function(e,n,t){function r(e,n,t){if(o.call(e,n))return e[n];var r=t();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(e,n,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return e[n]=r,r}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],handle:[function(e,n,t){function r(e,n,t,r){o.buffer([e],r),o.emit(e,n,t)}var o=e("ee").get("handle");n.exports=r,r.ee=o},{}],id:[function(e,n,t){function r(e){var n=typeof e;return!e||"object"!==n&&"function"!==n?-1:e===window?0:a(e,i,function(){return o++})}var o=1,i="nr@id",a=e("gos");n.exports=r},{}],loader:[function(e,n,t){function r(){if(!x++){var e=h.info=NREUM.info,n=d.getElementsByTagName("script")[0];if(setTimeout(s.abort,3e4),!(e&&e.licenseKey&&e.applicationID&&n))return s.abort();c(y,function(n,t){e[n]||(e[n]=t)}),f("mark",["onload",a()+h.offset],null,"api");var t=d.createElement("script");t.src="https://"+e.agent,n.parentNode.insertBefore(t,n)}}function o(){"complete"===d.readyState&&i()}function i(){f("mark",["domContent",a()+h.offset],null,"api")}function a(){return E.exists&&performance.now?Math.round(performance.now()):(u=Math.max((new Date).getTime(),u))-h.offset}var u=(new Date).getTime(),f=e("handle"),c=e(2),s=e("ee"),p=window,d=p.document,l="addEventListener",m="attachEvent",w=p.XMLHttpRequest,g=w&&w.prototype;NREUM.o={ST:setTimeout,CT:clearTimeout,XHR:w,REQ:p.Request,EV:p.Event,PR:p.Promise,MO:p.MutationObserver};var v=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1026.min.js"},b=w&&g&&g[l]&&!/CriOS/.test(navigator.userAgent),h=n.exports={offset:u,now:a,origin:v,features:{},xhrWrappable:b};e(1),d[l]?(d[l]("DOMContentLoaded",i,!1),p[l]("load",r,!1)):(d[m]("onreadystatechange",o),p[m]("onload",r)),f("mark",["firstbyte",u],null,"api");var x=0,E=e(4)},{}]},{},["loader"]);</script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">
  <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta name="description" content="很久没有写东西了，半年搞1个半app，2个ipad项目，人已疯。。。。 今天在重构代码，总结一下：MQTT的使用和坑 MQTT 是IBM开发的一个即时通讯协议，有可能成为物联网的重要组成部分。该协议支持所有平台，几乎可以把所有联网物品和外部连接起来，被用来当做传感器和致动器（比如通过Twitter让房屋联网）的通信协议 ----------------------百度词条解释 应用场景 MQ...">
  <meta property="wb:webmaster" content="294ec9de89e7fadb">
  <meta property="qc:admins" content="104102651453316562112116375">
  <meta property="qc:admins" content="11635613706305617">
  <meta property="qc:admins" content="1163561616621163056375">
  <meta name="google-site-verification" content="cV4-qkUJZR6gmFeajx_UyPe47GW9vY6cnCrYtCHYNh4">
  <meta name="google-site-verification" content="HF7lfF8YEGs1qtCE-kPml8Z469e2RHhGajy6JPVy5XI">
  <meta http-equiv="mobile-agent" content="format=html5; url=http://www.jianshu.com/p/80ea4507ca74">

  <!-- Apple -->
  <meta name="apple-mobile-web-app-title" content="简书">

    <!--  Meta for Smart App Banner -->
  <meta name="apple-itunes-app" content="app-id=888237539, app-argument=jianshu://notes/7267064">
  <!-- End -->

  <!--  Meta for Twitter Card -->
  <meta content="summary" property="twitter:card">
  <meta content="@jianshucom" property="twitter:site">
  <meta content="iOS MQTT----MQTTClient实战-看这篇的就够了" property="twitter:title">
  <meta content="很久没有写东西了，半年搞1个半app，2个ipad项目，人已疯。。。。 今天在重构代码，总结一下：MQTT的使用和坑 MQTT 是IBM开发的一个即时通讯协议，有可能成为物联网的重要组成部分。该协议支持所有平台，几乎可以把所有联网物品和外部连接起来，被用来当做传感器和致动器（比如通过Twitter让房屋联网）的通信协议 ----------------------百度词条解释 应用场景 MQTT是一个设计得非常出色的传输层协议，在移动消息、物联网、车联网、智能硬件甚至能源勘探等领域有着广泛的应用。1个字节报头、2个字节心跳、消息QoS支持等设计，非常适合在低带宽、不可靠网络、嵌入式设备上..." property="twitter:description">
  <meta content="http://www.jianshu.com/p/80ea4507ca74" property="twitter:url">
  <!-- End -->

  <!--  Meta for OpenGraph -->
  <meta property="fb:app_id" content="865829053512461">
  <meta property="og:site_name" content="简书">
  <meta property="og:title" content="iOS MQTT----MQTTClient实战-看这篇的就够了">
  <meta property="og:type" content="article">
  <meta property="og:url" content="http://www.jianshu.com/p/80ea4507ca74">
  <meta property="og:description" content="很久没有写东西了，半年搞1个半app，2个ipad项目，人已疯。。。。 今天在重构代码，总结一下：MQTT的使用和坑 MQTT 是IBM开发的一个即时通讯协议，有可能成为物联网的重要组成部分。该...">
  <!-- End -->

  <!--  Meta for Facebook Applinks -->
  <meta property="al:ios:url" content="jianshu://notes/7267064">
  <meta property="al:ios:app_store_id" content="888237539">
  <meta property="al:ios:app_name" content="简书">

  <meta property="al:android:url" content="jianshu://notes/7267064">
  <meta property="al:android:package" content="com.jianshu.haruki">
  <meta property="al:android:app_name" content="简书">
  <!-- End -->


    <title>iOS MQTT----MQTTClient实战-看这篇的就够了 - 简书</title>

  <meta name="csrf-param" content="authenticity_token">
<meta name="csrf-token" content="HAzdmR+lm+KL24LC1heIxM0+/h7RM2fMM3RbIySKstu0Jqxg0V/o8Qk618TZAl2ixkcdcZotY6C9Yb/DTlh9tQ==">

  <!--[if lte IE 8]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="stylesheet" media="all" href="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/web-fc03034c41024bedb415.css">
  
  <link rel="stylesheet" media="all" href="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/entry-fc03034c41024bedb415.css">
  <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if IE 8]><link rel="stylesheet" media="all" href="//cdn-qn0.jianshu.io/assets/scaffolding/for_ie-bc85f28c13463b327b20e81832b3d1c8.css" /><![endif]-->
  <!--[if lt IE 9]><link rel="stylesheet" media="all" href="//cdn-qn0.jianshu.io/assets/scaffolding/for_ie-bc85f28c13463b327b20e81832b3d1c8.css" /><![endif]-->
  <link href="http://cdn-qn0.jianshu.io/assets/favicons/favicon-ea87c042cbed82f63ec4cb18d1e1bc8b.ico" rel="icon">
      <link rel="apple-touch-icon-precomposed" href="http://cdn-qn0.jianshu.io/assets/apple-touch-icons/57-ce5a88a3e30a8f1f353e7b7e08710b47.png" sizes="57x57">
      <link rel="apple-touch-icon-precomposed" href="http://cdn-qn0.jianshu.io/assets/apple-touch-icons/72-d8f7a49ed070ff78bc7657785924d097.png" sizes="72x72">
      <link rel="apple-touch-icon-precomposed" href="http://cdn-qn0.jianshu.io/assets/apple-touch-icons/76-be915e70264c65090f03afff88e0f50c.png" sizes="76x76">
      <link rel="apple-touch-icon-precomposed" href="http://cdn-qn0.jianshu.io/assets/apple-touch-icons/114-fa410f47eef755b2aa43b94d63357102.png" sizes="114x114">
      <link rel="apple-touch-icon-precomposed" href="http://cdn-qn0.jianshu.io/assets/apple-touch-icons/120-50638ce65b8729b7761a4e68fe25724f.png" sizes="120x120">
      <link rel="apple-touch-icon-precomposed" href="http://cdn-qn0.jianshu.io/assets/apple-touch-icons/152-13b452db96e234a630d6d7bcbedbcd22.png" sizes="152x152">
</head>

  <body class="reader-black-font" lang="zh-CN">
    <!-- 全局顶部导航栏 -->
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="width-limit">
    <!-- 左上方 Logo -->
    <a class="logo" href="http://www.jianshu.com/"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/logo-58fd04f6f0de908401aa561cda6a0688.png" alt="Logo"></a>

    <!-- 右上角 -->
      <!-- 未登录显示登录/注册/写文章 -->
      <a class="btn write-btn" target="_blank" href="http://www.jianshu.com/writer#/">
        <i class="iconfont ic-write"></i>写文章
</a>      <a class="btn sign-up" href="http://www.jianshu.com/sign_up">注册</a>
      <a class="btn log-in" href="http://www.jianshu.com/sign_in">登录</a>

    <!-- 如果用户登录，显示下拉菜单 -->

    <div class="style-mode"><a class="style-mode-btn"><i class="iconfont ic-navigation-mode"></i></a> <div class="popover-modal" style="left: 0px; display: none;"><div class="meta"><i class="iconfont ic-navigation-night"></i><span>夜间模式</span></div> <div class="switch day-night-group"><a class="switch-btn">开</a> <a class="switch-btn active">关</a></div> <hr> <div class="switch font-family-group"><a class="switch-btn font-song">宋体</a> <a class="switch-btn font-hei active">黑体</a></div> <div class="switch"><a class="switch-btn active">简</a> <a class="switch-btn">繁</a></div></div></div>
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu" aria-expanded="false">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <div class="collapse navbar-collapse" id="menu">
        <ul class="nav navbar-nav">
            <li class="">
              <a href="http://www.jianshu.com/">
                <span class="menu-text">首页</span><i class="iconfont ic-navigation-discover menu-icon"></i>
</a>            </li>
            <li class="">
              <a class="app-download-btn" href="http://www.jianshu.com/apps"><span class="menu-text">下载App</span><i class="iconfont ic-navigation-download menu-icon"></i></a>
            </li>
          <li class="search">
            <form target="_blank" action="/search" accept-charset="UTF-8" method="get"><input name="utf8" value="✓" type="hidden">
              <input name="q" id="q" placeholder="搜索" class="search-input" type="text">
              <a class="search-btn" href="javascript:void(null)"><i class="iconfont ic-search"></i></a>
              <!-- <div id="navbar-trending-search"></div> -->
</form>          </li>
        </ul>
      </div>
    </div>
  </div>
</nav>

    
<div class="note">
  <div class="post">
    <div class="article">
        <h1 class="title">iOS MQTT----MQTTClient实战-看这篇的就够了</h1>

        <!-- 作者区域 -->
        <div class="author">
          <a class="avatar" href="http://www.jianshu.com/u/5ca191ab7337">
            <img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/4-3397163ecdb3855a0a4139c34a695885.jpg" alt="144">
</a>          <div class="info">
            <span class="tag">作者</span>
            <span class="name"><a href="http://www.jianshu.com/u/5ca191ab7337">今年我25</a></span>
            <!-- 关注用户按钮 -->
            <a class="btn btn-success follow"><i class="iconfont ic-follow"></i><span>关注</span></a>
            <!-- 文章数据信息 -->
            <div class="meta">
              <!-- 如果文章更新时间大于发布时间，那么使用 tooltip 显示更新时间 -->
                <span class="publish-time" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="最后编辑于 2016.12.08 15:18">2016.12.05 16:24*</span>
              <span class="wordage">字数 2316</span>
            <span class="views-count">阅读 2257</span><span class="comments-count">评论 10</span><span class="likes-count">喜欢 21</span></div>
          </div>
          <!-- 如果是当前作者，加入编辑按钮 -->
        </div>
        <!-- -->

        <!-- 文章内容 -->
        <div class="show-content">
          <p>很久没有写东西了，半年搞1个半app，2个ipad项目，人已疯。。。。</p><p>今天在重构代码，总结一下：MQTT的使用和坑</p><p>MQTT
 
是IBM开发的一个即时通讯协议，有可能成为物联网的重要组成部分。该协议支持所有平台，几乎可以把所有联网物品和外部连接起来，被用来当做传感器和致动
器（比如通过Twitter让房屋联网）的通信协议 ----------------------百度词条解释</p><hr><p>应用场景<br></p><p>MQTT是一个设计得非常出色的传输层协议，在移动消息、物联网、车联网、智能硬件甚至能源勘探等领域有着广泛的应用。1个字节报头、2个字节心跳、消息QoS支持等设计，非常适合在低带宽、不可靠网络、嵌入式设备上应用。</p><p>不同的应用有不同的系统要求，用户使用emqttd消息服务器前，可以按自己的应用场景进行测试，而不是简单的连接压力测试:</p><p>Android消息推送: 推送消息广播测试。</p><p>移动即时消息应用: 消息收发确认测试。</p><p>智能硬件应用: 消息的往返时延测试。</p><p>物联网数据采集: 并发连接与吞吐测试</p><p><br></p><p>其他的不多说，有很多资料，一般常用的有两个MQTT</p><p>1.MQTTKit</p><p>2.MQTTClient</p><p>两个都用过，不过目前用的是MQTTClient,在Ios10出来后更新了一版，经常维护；</p><p>MQTTKit，这个貌似很久没更新了，也不多说</p><p><br></p><p>首先明确一下你拿这个东西干嘛的，拿我做的app来说:</p><p>在地图页面，请求历史数据，然后通过mqtt订阅主题，获取终端的返回的数据,然后实时更新数据,效果就类似于打车软件的样子,实现实时监控数据等功能。</p><hr><h1>第一步：安装MQTT</h1><p><a href="https://github.com/ckrey/MQTT-Client-Framework" target="_blank">MQTT-Client-Framework</a> &nbsp; GitHub地址</p><p>用cocopod的直接，下载就好 &nbsp; pod 'MQTTClient'<br></p><p><br></p><h1>第二步:</h1><p><br></p><div class="image-package">
<img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/234562-163038fb5c5121c1.png" style="cursor: zoom-in;"><br><div class="image-caption"></div>
</div><hr><p>安装好之后就这样，每个类一看知道就是干嘛，直接上代码详细说</p><h1><br></h1><h1>第三步：</h1><p>导入 #import&lt;MQTTClient/MQTTClient&gt;</p><p>1.设置地址和端口号.</p><div class="image-package">
<img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/234562-33c459cc2fb4381c.png" style="cursor: zoom-in;"><br><div class="image-caption"></div>
</div><p>2.设置mqtt的账号和密码，同样找好基友要</p><div class="image-package">
<img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/234562-d8194d42044559f0.png" style="cursor: zoom-in;"><br><div class="image-caption"></div>
</div><p>3. 最后订阅主题，这个地方看了很多人写的博客，假设你的主题很多比如5个,10个，使用线程处理，这样也是可以的，但是不是最优化的方式，后面会详细说明，对了mqtt是可以同时订阅多个主题的，很多资料都未说明.</p><p>这个地方用了枚举，主要是为了判断订阅主题，来处理回调的数据</p><p>//注意:订阅主题不能放到子线程进行,否则block不会回调</p><p>//下面这些都是自己封装过得</p><h4>//主题格式 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;@“$IOT/haha/datapoint/motor_control”</h4><div class="image-package">
<img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/234562-8a80838e292c2710.png" style="cursor: zoom-in;"><br><div class="image-caption"></div>
</div><p>//如果不封装就是这样的</p><div class="image-package">
<img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/234562-279d163a974425be.png" style="cursor: zoom-in;"><br><div class="image-caption"></div>
</div><p><i>这样就实现了主题订阅,订阅成功后会有log，一堆信息，这样的</i></p><div class="image-package">
<img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/234562-2261bb6e91091581.png" style="cursor: zoom-in;"><br><div class="image-caption"></div>
</div><h1>第四步：实现Session代理方法，处理数据</h1><div class="image-package">
<img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/234562-67fecc0795760242.png" style="cursor: zoom-in;"><br><div class="image-caption"></div>
</div><p>在代理方法中，就可以得到对应的数据，在这里说明一下</p><p>1.如果你订阅的主题只有一个，那么你不判断也是可以的，但是如果有多个主题，你需要判断，返回的哪个对应的主题，然后才能处理数据。</p><p><i>2.<b>你订阅主题假如是这样的 &nbsp; &nbsp;@“$IOT/haha/datapoint/motor_control” &nbsp;，那么在处理数据时，你判断“<i>motor_control</i>”字符串就可以找到对应的数据,判断最后的参数就行，看截图就明白了.</b></i></p><p><i>3.然后拿到你的数据，你想干嘛就干嘛.</i></p><p><i><br></i></p><p><i>(⊙o⊙)…，到这里基本的就完了，那是不可能的，我发现很多资料写到这里就完了，还有很多的重点没说明,不然整理东西就没意义了.</i></p><hr><p><i><br></i></p><h2>可能大家用处不一样的，有人会碰到，有人不会，在这里说明一下，可能会遇到的问题:</h2><p><br></p><h3>1.先说常用的属性，如果你一直把mqtt开着，你不处理，那么mqtt一直会有数据返回，我这边就是1秒一次，然后一堆数据....</h3><p>在刚开始的时候，初始化了 MQTTSession 的对象，看截图</p><p>[self.mySession disconnect] 断开连接 对应的就是 [self.mySession connect] 重新连接 </p><p>如果不需要mqtt了，记得close，不然mqtt还会返回数据.<br></p><p>当然这个截图，只是全部举例说明，如果不用mqtt直接，close就搞定，不需要写这么多.</p><div class="image-package">
<img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/234562-bc6d2e8d76396d1a.png" style="cursor: zoom-in;"><br><div class="image-caption"></div>
</div><h3>2.在正常情况下，你的mqtt成功订阅了主题，那么它会一直在监听服务器是否有数据返回,但是有的时候嘛，你会遇到下面这中情况,mqtt停止了，当然排除你自己 close的情况外.</h3><div class="image-package">
<img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/234562-e5e93f776030e0ba.png" style="cursor: zoom-in;"><br><div class="image-caption"></div>
</div><p>这种情况就很坑爹啦，你用mqtt的目的是啥，就是要实时监控嘛。。。。</p><p>在我查询的资料中有几种解释：</p><p>前提是你家的服务器一直在发送数据，而不是停掉了</p><p>2.1 你的clientID，没有设置，简单说明,你有一个账号是老王，那么你登录了，你的同事也登录了，这个时候,mqtt会自动掉线。</p><p>self.mySession.clientId
 有这个属性,我咨询过后台，说移动端要设置，设置成功就可以避免，但是如果你用的是，MQTTClient 
这个，完全不用，因为别人已经处理好了，可以自己点击进去看看,那么如果你用的是其他的第三方，clientId需要取<b>随机数</b>，不能相同.</p><p>2.2 碰到上面这个问题咋办呢，<b>MQTTClient 没有断线重连的机制</b>，也可能是我没找到，哪位小伙伴看到了也麻烦告诉我一声.</p><p>这个时候，你需要监听消息的状态，就可以处理了，来看看，<b>self.mySession.status</b>的值</p><div class="image-package">
<img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/234562-8a335c7f68554e25.png" style="cursor: zoom-in;"><br><div class="image-caption"></div>
</div><p>在上面也写到了，如果你使用disconnect\connect，那么消息的状态最终都会输出第五个MQTTSessionStatusClosed.</p><p>2.3 介绍两种监听方法:</p><p>2.3.1 &nbsp;KVO &nbsp; &nbsp;在创建MQTTSession对象的时候,添加就可以了</p><div class="image-package">
<img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/234562-38a09285432fc95d.png" style="cursor: zoom-in;"><br><div class="image-caption"></div>
</div><div class="image-package">
<img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/234562-70d58443a9f4e021.png" style="cursor: zoom-in;"><br><div class="image-caption"></div>
</div><p>这样只要消息关闭了，那么mqtt会立即重连；但是会有一个问题，如果你的mqtt只是部分页面用，离开这个页面之后，mqtt还会继续监听，不停的创建对象，上面解释过了，消息状态最终都是MQTTSessionStatusClosed.</p><p>2.3.2 目前我在用就是定时器,用定时器处理消息状态</p><div class="image-package">
<img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/234562-9ed79fe020737395.png" style="cursor: zoom-in;"><br><div class="image-caption"></div>
</div><h3>
<img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/234562-98f2fb58eee80d15.png"><br><div class="image-caption"></div>
</h3><p>好处就是，离开页面的时候，mqtt关闭，定时器也关闭，不会导致kvo那种情况出现,坏处暂时没发现.</p><p>这样就可以让mqtt一只处于监控的状态下了.</p><h3><hr></h3><h3>3.关于MQTT一次性订阅多个主题，每个mqtt框架都可以。</h3><p>假如你要一次性订阅10个主题，那么你不得写十次么，完全不用这样,现在介绍一个更简单的办法，</p><p>你只需要更改一个地方就可以了，主题URL</p><p>上面我写的主题格式是这样的</p><p>//主题格式 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;@“$IOT/haha/datapoint/motor_control”<br></p><p><b>现在你只需要把主题的URL &nbsp;改成这样 &nbsp;@"$IOT/haha/#"</b></p><p><b>MQTT主题(Topic)支持’+’, ‘#’的通配符，’+’通配一个层级，’#’通配多个层级(必须在末尾)<br></b></p><p><b>解释一下，#表示，haha下面的所有主题，假如你有10个主题，你这样就可以一次性订阅完成，然后你在返回的数据中，判断对应的主题处理数据就可以了.</b></p><p>代码中就可以把其它的注释掉.</p><div class="image-package">
<img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/234562-5a9f5c70031fffa4.png" style="cursor: zoom-in;"><br><div class="image-caption"></div>
</div><p>话又说回来，一个页面你只用到一个主题的内容，你难道也这样写嘛，所以一切看实际情况。</p><h3></h3><p><br></p><h3>4.最后说一个，MQTT超时时间设置的问题.</h3><p>[self.mySession connectAndWaitTimeout:1];<br></p><p>MQTT在网络情况不太好/接收不到服务器数据时，容易导致线程卡住，你懂得，什么都不能点了，建议把这里的时间设置小一点.</p><p><br></p><h3>5.其他</h3><p>最最后，补充一个网站，后台搭建mqtt服务器，移动端使用原理介绍都可以用，MQTT介绍的很全面了,深入了解的可以看看，有swift和oc的版本，这个我没用过，原理一样.</p><p><a href="http://emqtt.com/docs/v2/getstarted.html#emq-2-0" target="_blank">MQTT-EMQ服务器搭建</a><br></p><p><br></p><p>6.DEMO 下载地址 &nbsp; &nbsp;暂无，弄好了再传</p>
        </div>
        <!--  -->

        <div class="show-foot">
          <a class="notebook" href="http://www.jianshu.com/nb/482654">
            <i class="iconfont ic-search-notebook"></i> <span>OC/Swift</span>
</a>          <div class="copyright" data-toggle="tooltip" data-html="true" data-original-title="转载请联系作者获得授权，并标注“简书作者”。">
            © 著作权归作者所有
          </div>
          <div class="modal-wrap" data-report-note="">
            <a id="report-modal">举报文章</a>
          </div>
        </div>
    </div>

    <!-- 文章底部作者信息 -->
      <div class="follow-detail">
        <div class="info">
          <a class="avatar" href="http://www.jianshu.com/u/5ca191ab7337">
            <img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/4-3397163ecdb3855a0a4139c34a695885.jpg" alt="144">
</a>          <a class="btn btn-success follow"><i class="iconfont ic-follow"></i><span>关注</span></a>
          <a class="title" href="http://www.jianshu.com/u/5ca191ab7337">今年我25</a>
        <p>写了 6746 字，被 61 人关注，获得了 72 个喜欢</p></div>
      </div>

      <div class="support-author"><p>如果觉得我的文章对您有用，请随意打赏。您的支持将鼓励我继续创作！</p> <div class="btn btn-pay">赞赏支持</div> <!----> <!----> <!----></div>

    <div class="meta-bottom">
      <div class="like"><div class="btn like-group"><div class="btn-like"><a href="http://www.jianshu.com/sign_in"><i class="iconfont ic-like"></i>喜欢</a></div> <div class="modal-wrap"><a>21</a></div></div> <!----></div>
      <div class="share-group">
        <a class="share-circle" data-action="weixin-share" data-toggle="tooltip" data-original-title="分享到微信">
          <i class="iconfont ic-wechat"></i>
        </a>
        <a class="share-circle" data-toggle="tooltip" href="javascript:void((function(s,d,e,r,l,p,t,z,c){var%20f='http://v.t.sina.com.cn/share/share.php?appkey=1881139527',u=z||d.location,p=['&amp;url=',e(u),'&amp;title=',e(t||d.title),'&amp;source=',e(r),'&amp;sourceUrl=',e(l),'&amp;content=',c||'gb2312','&amp;pic=',e(p||'')].join('');function%20a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=440,height=430,left=',(s.width-440)/2,',top=',(s.height-430)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent))setTimeout(a,0);else%20a();})(screen,document,encodeURIComponent,'','','http://cwb.assets.jianshu.io/notes/images/7267064/weibo/image_382ee862c33c.jpg',%20'%E6%8E%A8%E8%8D%90%20%E4%BB%8A%E5%B9%B4%E6%88%9125%20%E7%9A%84%E6%96%87%E7%AB%A0%E3%80%8AiOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%E3%80%8B%EF%BC%88%20%E5%88%86%E4%BA%AB%E8%87%AA%20@%E7%AE%80%E4%B9%A6%20%EF%BC%89','http://www.jianshu.com/p/80ea4507ca74?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=weibo','%E9%A1%B5%E9%9D%A2%E7%BC%96%E7%A0%81gb2312|utf-8%E9%BB%98%E8%AE%A4gb2312'));" data-original-title="分享到微博">
          <i class="iconfont ic-weibo"></i>
        </a>
          <a class="share-circle" data-toggle="tooltip" href="http://cwb.assets.jianshu.io/notes/images/7267064/weibo/image_382ee862c33c.jpg" target="_blank" data-original-title="下载长微博图片">
            <i class="iconfont ic-picture"></i>
          </a>
        <a class="share-circle more-share" tabindex="0" data-toggle="popover" data-placement="top" data-html="true" data-trigger="focus" href="javascript:void(0);" data-content="
          &lt;ul class=&quot;share-list&quot;&gt;
            &lt;li&gt;&lt;a href=&quot;javascript:void(function(){var d=document,e=encodeURIComponent,r='http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url='+e('http://www.jianshu.com/p/80ea4507ca74?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=qzone')+'&amp;title='+e('推荐 今年我25 的文章《iOS MQTT----MQTTClient实战-看这篇的就够了》'),x=function(){if(!window.open(r,'qzone','toolbar=0,resizable=1,scrollbars=yes,status=1,width=600,height=600'))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();&quot;&gt;&lt;i class=&quot;social-icon-sprite social-icon-zone&quot;&gt;&lt;/i&gt;&lt;span&gt;分享到QQ空间&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href=&quot;javascript:void(function(){var d=document,e=encodeURIComponent,r='https://twitter.com/share?url='+e('http://www.jianshu.com/p/80ea4507ca74?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=twitter')+'&amp;text='+e('推荐 今年我25 的文章《iOS MQTT----MQTTClient实战-看这篇的就够了》（ 分享自 @jianshucom ）')+'&amp;related='+e('jianshucom'),x=function(){if(!window.open(r,'twitter','toolbar=0,resizable=1,scrollbars=yes,status=1,width=600,height=600'))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();&quot;&gt;&lt;i class=&quot;social-icon-sprite social-icon-twitter&quot;&gt;&lt;/i&gt;&lt;span&gt;分享到Twitter&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href=&quot;javascript:void(function(){var d=document,e=encodeURIComponent,r='https://www.facebook.com/dialog/share?app_id=483126645039390&amp;display=popup&amp;href=http://www.jianshu.com/p/80ea4507ca74?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=facebook',x=function(){if(!window.open(r,'facebook','toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330'))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();&quot;&gt;&lt;i class=&quot;social-icon-sprite social-icon-facebook&quot;&gt;&lt;/i&gt;&lt;span&gt;分享到Facebook&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href=&quot;javascript:void(function(){var d=document,e=encodeURIComponent,r='https://plus.google.com/share?url='+e('http://www.jianshu.com/p/80ea4507ca74?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=google_plus'),x=function(){if(!window.open(r,'google_plus','toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330'))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();&quot;&gt;&lt;i class=&quot;social-icon-sprite social-icon-google&quot;&gt;&lt;/i&gt;&lt;span&gt;分享到Google+&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href=&quot;javascript:void(function(){var d=document,e=encodeURIComponent,s1=window.getSelection,s2=d.getSelection,s3=d.selection,s=s1?s1():s2?s2():s3?s3.createRange().text:'',r='http://www.douban.com/recommend/?url='+e('http://www.jianshu.com/p/80ea4507ca74?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=douban')+'&amp;title='+e('iOS MQTT----MQTTClient实战-看这篇的就够了')+'&amp;sel='+e(s)+'&amp;v=1',x=function(){if(!window.open(r,'douban','toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330'))location.href=r+'&amp;r=1'};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})()&quot;&gt;&lt;i class=&quot;social-icon-sprite social-icon-douban&quot;&gt;&lt;/i&gt;&lt;span&gt;分享到豆瓣&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
          &lt;/ul&gt;
        " data-original-title="" title="">更多分享</a>
      </div>
    </div>
    <div><div id="comment-list" class="comment-list"><div><form class="new-comment"><a class="avatar"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/avatar_default-78d4d1f68984cd6d4379508dd94b4210.png"></a> <div class="sign-container"><a href="http://www.jianshu.com/sign_in" class="btn btn-sign">登录</a> <span>后发表评论</span></div></form></div> <div id="normal-comment-list" class="normal-comment-list"><div><div><div class="top"><span>10条评论</span> <a class="author-only">只看作者</a> <a class="close-btn" style="display: none;">关闭评论</a> <div class="pull-right"><a class="active">按喜欢排序</a><a class="">按时间正序</a><a class="">按时间倒序</a></div></div></div> <!----> <!----> <div id="comment-6214614" class="comment"><div><div class="author"><a href="http://www.jianshu.com/u/719a1fc68e37" target="_blank" class="avatar"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/317d8dc2ef3f.jpg"></a> <div class="info"><a href="http://www.jianshu.com/u/719a1fc68e37" target="_blank" class="name">mark666</a> <!----> <div class="meta"><span>2楼 · 2016.12.06 18:34</span></div></div></div> <div class="comment-wrap"><p>我的文章扩展</p> <div class="tool-group"><a><i class="iconfont ic-zan"></i> <span>赞</span></a> <a><i class="iconfont ic-comment"></i> <span>回复</span></a> <!----> <!----></div></div></div> <div class="sub-comment-list hide"><!----> <!----></div></div><div id="comment-6231140" class="comment"><div><div class="author"><a href="http://www.jianshu.com/u/a825e8148427" target="_blank" class="avatar"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/235203e9c893.jpg"></a> <div class="info"><a href="http://www.jianshu.com/u/a825e8148427" target="_blank" class="name">幸福的李雨龙</a> <!----> <div class="meta"><span>4楼 · 2016.12.07 11:02</span></div></div></div> <div class="comment-wrap"><p>安装说明书👏👏👏</p> <div class="tool-group"><a><i class="iconfont ic-zan"></i> <span>赞</span></a> <a><i class="iconfont ic-comment"></i> <span>回复</span></a> <!----> <!----></div></div></div> <div class="sub-comment-list hide"><!----> <!----></div></div><div id="comment-6232486" class="comment"><div><div class="author"><a href="http://www.jianshu.com/u/7e6dc53188b8" target="_blank" class="avatar"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/213cd118a975.jpg"></a> <div class="info"><a href="http://www.jianshu.com/u/7e6dc53188b8" target="_blank" class="name">Schorem</a> <!----> <div class="meta"><span>5楼 · 2016.12.07 11:52</span></div></div></div> <div class="comment-wrap"><p>iOS</p> <div class="tool-group"><a><i class="iconfont ic-zan"></i> <span>赞</span></a> <a><i class="iconfont ic-comment"></i> <span>回复</span></a> <!----> <!----></div></div></div> <div class="sub-comment-list hide"><!----> <!----></div></div><div id="comment-6712576" class="comment"><div><div class="author"><a href="http://www.jianshu.com/u/74e208c38b22" target="_blank" class="avatar"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/87365870c358.jpg"></a> <div class="info"><a href="http://www.jianshu.com/u/74e208c38b22" target="_blank" class="name">74e208c38b22</a> <!----> <div class="meta"><span>6楼 · 2016.12.27 11:32</span></div></div></div> <div class="comment-wrap"><p>厉害！ 可以发一下demo吧，谢谢！</p> <div class="tool-group"><a><i class="iconfont ic-zan"></i> <span>赞</span></a> <a><i class="iconfont ic-comment"></i> <span>回复</span></a> <!----> <!----></div></div></div> <div class="sub-comment-list hide"><!----> <!----></div></div><div id="comment-6882638" class="comment"><div><div class="author"><a href="http://www.jianshu.com/u/30b276a81a64" target="_blank" class="avatar"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/12-aeeea4bedf10f2a12c0d50d626951489.jpg"></a> <div class="info"><a href="http://www.jianshu.com/u/30b276a81a64" target="_blank" class="name">TigerNong</a> <!----> <div class="meta"><span>7楼 · 2017.01.03 21:06</span></div></div></div> <div class="comment-wrap"><p>你再写这个MQTT的时候，有没有出现当程序没有退出，但是放置在前台一段时间（超过10分钟）后，当再次进入到前台的时候，MQTT会主动断开！？<br></p> <div class="tool-group"><a><i class="iconfont ic-zan"></i> <span>赞</span></a> <a><i class="iconfont ic-comment"></i> <span>回复</span></a> <!----> <!----></div></div></div> <div class="sub-comment-list hide"><!----> <!----></div></div><div id="comment-7958741" class="comment"><div><div class="author"><a href="http://www.jianshu.com/u/0388b9b4278b" target="_blank" class="avatar"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/d57f25589ba3.jpg"></a> <div class="info"><a href="http://www.jianshu.com/u/0388b9b4278b" target="_blank" class="name">Jin_先生</a> <!----> <div class="meta"><span>8楼 · 2017.02.13 10:47</span></div></div></div> <div class="comment-wrap"><p>使用mqtt可以达到像ios中网易云音乐播放器一样在后台持续运行的效果吗？</p> <div class="tool-group"><a><i class="iconfont ic-zan"></i> <span>赞</span></a> <a><i class="iconfont ic-comment"></i> <span>回复</span></a> <!----> <!----></div></div></div> <div class="sub-comment-list hide"><!----> <!----></div></div><div id="comment-8053073" class="comment"><div><div class="author"><a href="http://www.jianshu.com/u/f6e3982b50ee" target="_blank" class="avatar"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/972db15d-dc75-47e7-8f9a-cb0cbb41efad.jpg"></a> <div class="info"><a href="http://www.jianshu.com/u/f6e3982b50ee" target="_blank" class="name">ssZhen</a> <!----> <div class="meta"><span>9楼 · 2017.02.16 13:51</span></div></div></div> <div class="comment-wrap"><p>最近就是用mqtt，遇到一些作者说的那些。看一下有了更深层的理解，感谢分享，嘻嘻</p> <div class="tool-group"><a><i class="iconfont ic-zan"></i> <span>赞</span></a> <a><i class="iconfont ic-comment"></i> <span>回复</span></a> <!----> <!----></div></div></div> <div class="sub-comment-list hide"><!----> <!----></div></div><div id="comment-8175312" class="comment"><div><div class="author"><a href="http://www.jianshu.com/u/16bac4d02dff" target="_blank" class="avatar"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/fd53c7b12ae6.gif"></a> <div class="info"><a href="http://www.jianshu.com/u/16bac4d02dff" target="_blank" class="name">四毛先森丶</a> <!----> <div class="meta"><span>10楼 · 2017.02.20 15:26</span></div></div></div> <div class="comment-wrap"><p>CKHttpTools有demo吗？？？？</p> <div class="tool-group"><a><i class="iconfont ic-zan"></i> <span>赞</span></a> <a><i class="iconfont ic-comment"></i> <span>回复</span></a> <!----> <!----></div></div></div> <div class="sub-comment-list hide"><!----> <!----></div></div><div id="comment-8924894" class="comment"><div><div class="author"><a href="http://www.jianshu.com/u/67800d7adfe9" target="_blank" class="avatar"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/fd5ea125fb04.jpg"></a> <div class="info"><a href="http://www.jianshu.com/u/67800d7adfe9" target="_blank" class="name">keepin</a> <!----> <div class="meta"><span>11楼 · 2017.03.13 16:43</span></div></div></div> <div class="comment-wrap"><p>楼主  我遇到你所说的那个问题  我监听重连之后 怎么不返回数据。。求解</p> <div class="tool-group"><a><i class="iconfont ic-zan"></i> <span>赞</span></a> <a><i class="iconfont ic-comment"></i> <span>回复</span></a> <!----> <!----></div></div></div> <div class="sub-comment-list hide"><!----> <!----></div></div><div id="comment-9746879" class="comment"><div><div class="author"><a href="http://www.jianshu.com/u/8491bc0fde5d" target="_blank" class="avatar"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/9c3f05143785.jpg"></a> <div class="info"><a href="http://www.jianshu.com/u/8491bc0fde5d" target="_blank" class="name">倒影里浅笑</a> <!----> <div class="meta"><span>12楼 · 2017.04.06 09:45</span></div></div></div> <div class="comment-wrap"><p>MQTTClient
 
没有断线重连的机制,但MQTTSession中有一个block是监听连接状态的connectionHandler，当连接状态发生改变时就会执行
block，而block的参数中有连接状态，根据这个状态就可以判断是否连接上，这样的话就不需要用定时器处理了吧</p> <div class="tool-group"><a><i class="iconfont ic-zan"></i> <span>赞</span></a> <a><i class="iconfont ic-comment"></i> <span>回复</span></a> <!----> <!----></div></div></div> <div class="sub-comment-list hide"><!----> <!----></div></div> <div class="comments-placeholder" style="display: none;"><div class="author"><div class="avatar"></div> <div class="info"><div class="name"></div> <div class="meta"></div></div></div> <div class="text"></div> <div class="text animation-delay"></div> <div class="tool-group"><i class="iconfont ic-zan-active"></i><div class="zan"></div> <i class="iconfont ic-list-comments"></i><div class="zan"></div></div></div></div></div> <!----> <!----></div></div>
  </div>

  <div class="side-tool"><ul><li data-placement="left" data-toggle="tooltip" data-container="body" data-original-title="回到顶部" style=""><a href="#" class="function-button"><i class="iconfont ic-backtop"></i></a></li> <!----> <!----> <li data-placement="left" data-toggle="tooltip" data-container="body" data-original-title="分享文章"><a tabindex="0" role="button" data-toggle="popover" data-placement="left" data-html="true" data-trigger="focus" href="javascript:void(0);" data-content="&lt;ul class='share-list'&gt;
                &lt;li&gt;&lt;a class=&quot;weixin-share&quot;&gt;&lt;i class=&quot;social-icon-sprite social-icon-weixin&quot;&gt;&lt;/i&gt;&lt;span&gt;分享到微信&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href=&quot;javascript:void((function(s,d,e,r,l,p,t,z,c){var%20f='http://v.t.sina.com.cn/share/share.php?appkey=1881139527',u=z||d.location,p=['&amp;url=',e(u),'&amp;title=',e(t||d.title),'&amp;source=',e(r),'&amp;sourceUrl=',e(l),'&amp;content=',c||'gb2312','&amp;pic=',e(p||'')].join('');function%20a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=440,height=430,left=',(s.width-440)/2,',top=',(s.height-430)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent))setTimeout(a,0);else%20a();})(screen,document,encodeURIComponent,'','','http://cwb.assets.jianshu.io/notes/images/7267064/weibo/image_382ee862c33c.jpg', '推荐 今年我25 的文章《iOS MQTT----MQTTClient实战-看这篇的就够了》（ 分享自 @简书 ）','http://www.jianshu.com/p/80ea4507ca74?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=weibo','页面编码gb2312|utf-8默认gb2312'));&quot;&gt;&lt;i class='social-icon-sprite social-icon-weibo'&gt;&lt;/i&gt;&lt;span&gt;分享到微博&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href=&quot;http://cwb.assets.jianshu.io/notes/images/7267064/weibo/image_382ee862c33c.jpg&quot; target=&quot;_blank&quot;&gt;&lt;i class=&quot;social-icon-sprite social-icon-picture&quot;&gt;&lt;/i&gt;&lt;span&gt;下载长微博图片&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href=&quot;javascript:void(function(){var d=document,e=encodeURIComponent,r='http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url='+e('http://www.jianshu.com/p/80ea4507ca74?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=qzone')+'&amp;title='+e('推荐 今年我25 的文章《iOS MQTT----MQTTClient实战-看这篇的就够了》'),x=function(){if(!window.open(r,'qzone','toolbar=0,resizable=1,scrollbars=yes,status=1,width=600,height=600'))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();&quot;&gt;&lt;i class='social-icon-sprite social-icon-zone'&gt;&lt;/i&gt;&lt;span&gt;分享到QQ空间&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href=&quot;javascript:void(function(){var d=document,e=encodeURIComponent,r='https://twitter.com/share?url='+e('http://www.jianshu.com/p/80ea4507ca74?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=twitter')+'&amp;text='+e('推荐 今年我25 的文章《iOS MQTT----MQTTClient实战-看这篇的就够了》（ 分享自 @jianshucom ）')+'&amp;related='+e('jianshucom'),x=function(){if(!window.open(r,'twitter','toolbar=0,resizable=1,scrollbars=yes,status=1,width=600,height=600'))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();&quot;&gt;&lt;i class='social-icon-sprite social-icon-twitter'&gt;&lt;/i&gt;&lt;span&gt;分享到Twitter&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href=&quot;javascript:void(function(){var d=document,e=encodeURIComponent,r='https://www.facebook.com/dialog/share?app_id=483126645039390&amp;display=popup&amp;href=http://www.jianshu.com/p/80ea4507ca74?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=facebook',x=function(){if(!window.open(r,'facebook','toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330'))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();&quot;&gt;&lt;i class='social-icon-sprite social-icon-facebook'&gt;&lt;/i&gt;&lt;span&gt;分享到Facebook&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href=&quot;javascript:void(function(){var d=document,e=encodeURIComponent,r='https://plus.google.com/share?url='+e('http://www.jianshu.com/p/80ea4507ca74?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=google_plus'),x=function(){if(!window.open(r,'google_plus','toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330'))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();&quot;&gt;&lt;i class='social-icon-sprite social-icon-google'&gt;&lt;/i&gt;&lt;span&gt;分享到Google+&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href=&quot;javascript:void(function(){var d=document,e=encodeURIComponent,s1=window.getSelection,s2=d.getSelection,s3=d.selection,s=s1?s1():s2?s2():s3?s3.createRange().text:'',r='http://www.douban.com/recommend/?url='+e('http://www.jianshu.com/p/80ea4507ca74?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=douban')+'&amp;title='+e('iOS MQTT----MQTTClient实战-看这篇的就够了')+'&amp;sel='+e(s)+'&amp;v=1',x=function(){if(!window.open(r,'douban','toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330'))location.href=r+'&amp;r=1'};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})()&quot;&gt;&lt;i class='social-icon-sprite social-icon-douban'&gt;&lt;/i&gt;&lt;span&gt;分享到豆瓣&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
              &lt;/ul&gt;" data-original-title="" title="" class="function-button"><i class="iconfont ic-share"></i></a> <!----></li></ul></div>
</div>
<div class="note-bottom"><div class="main"><div class="title">被以下专题收入，发现更多相似内容</div> <!----> <div class="include-collection"><!----> <a href="http://www.jianshu.com/c/3233d1a249ca?utm_source=desktop&amp;utm_medium=notes-included-collection" target="_blank" class="item"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/162902612251cbd95971b82.png"><div class="name">iOS Dev...</div></a><a href="http://www.jianshu.com/c/bDHhpK?utm_source=desktop&amp;utm_medium=notes-included-collection" target="_blank" class="item"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/a.png"><div class="name">首页投稿</div></a><a href="http://www.jianshu.com/c/NEt52a?utm_source=desktop&amp;utm_medium=notes-included-collection" target="_blank" class="item"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/computer_guy.jpg"><div class="name">程序员</div></a><a href="http://www.jianshu.com/c/544a2c14ca67?utm_source=desktop&amp;utm_medium=notes-included-collection" target="_blank" class="item"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/1430586106.png"><div class="name">iOS</div></a><a href="http://www.jianshu.com/c/007ab4b9baf5?utm_source=desktop&amp;utm_medium=notes-included-collection" target="_blank" class="item"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/u_1487935503_3996218764_fm_21_gp_0.jpg"><div class="name">计算机技术一锅炖</div></a><a href="http://www.jianshu.com/c/21521d25ef91?utm_source=desktop&amp;utm_medium=notes-included-collection" target="_blank" class="item"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/10801920.jpg"><div class="name">iOS精彩集锦</div></a><a href="http://www.jianshu.com/c/9a56f7fc508d?utm_source=desktop&amp;utm_medium=notes-included-collection" target="_blank" class="item"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/bg.png"><div class="name">编程知识点</div></a><a href="http://www.jianshu.com/c/18abf66610ae?utm_source=desktop&amp;utm_medium=notes-included-collection" target="_blank" class="item"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/1476865587.jpg"><div class="name">晚期代码癌患者</div></a><a href="http://www.jianshu.com/c/73632d5c8841?utm_source=desktop&amp;utm_medium=notes-included-collection" target="_blank" class="item"><img src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/IMG_0036.jpg"><div class="name">iOS 开发成神之路</div></a></div> <!----></div> <!----> <!----></div>

    <script type="application/json" data-name="page-data">{"user_signed_in":false,"locale":"zh-CN","os":"mac","read_mode":"day","read_font":"font2","note_show":{"is_author":false,"is_following_author":false,"is_liked_note":false,"uuid":"2ce37a3f-f5fb-4e89-9c16-fcd543b56490"},"note":{"id":7267064,"slug":"80ea4507ca74","user_id":234562,"notebook_id":482654,"commentable":true,"likes_count":21,"views_count":2257,"public_wordage":2316,"comments_count":10,"author":{"total_wordage":6746,"followers_count":61,"total_likes_count":72}}}</script>
    
    <script src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/babel-polyfill-fc03034c41024bedb415.js"></script>
    <script src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/web-base-fc03034c41024bedb415.js"></script>
<script src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/web-fc03034c41024bedb415.js"></script>
    
    <script src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/entry-fc03034c41024bedb415.js"></script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-35169517-1', 'auto');
  ga('send', 'pageview');
</script>

<div style="display:none">
  <script src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/z_stat.php" language="JavaScript"></script><script src="iOS%20MQTT----MQTTClient%E5%AE%9E%E6%88%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E7%9A%84%E5%B0%B1%E5%A4%9F%E4%BA%86%20-%20%E7%AE%80%E4%B9%A6_files/core.php" charset="utf-8" type="text/javascript"></script><a href="http://www.cnzz.com/stat/website.php?web_id=1258679142" target="_blank" title="站长统计">站长统计</a>
</div>

<script>
  (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();
</script>

  

<!----><!----></body></html>